<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quiz o nas â¤ï¸</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">

  <!-- MENU -->
 <div id="menu" class="screen active">
  <h1>Klaudiusz â¤ï¸ Marysia <a href="admin.html" target="_blank" style="font-size:0.6rem; opacity:0.4; text-decoration:none;">admin</a></h1>
  <p style="text-align:center; font-size:1.45rem; color:#d81b60; margin:-8px 0 32px; opacity:0.92; font-style:italic;">
    Nasz maÅ‚y quiz miÅ‚oÅ›ci â™¡
  </p>
  
  <p class="total-points">Nasze punkty razem: <span id="totalScore">0</span></p>
  
  <button class="big-btn play" id="playBtn">ğŸ® Graj teraz</button>
  <button class="big-btn rewards" id="rewardsBtn">ğŸ Nasze nagrody</button>
  <button class="big-btn" id="addQuestionBtn"
  style="background:linear-gradient(135deg,#7bffb3,#4caf50);font-size:1.9rem;">
  â• Dodaj wÅ‚asne pytanie
</button>


    <!-- Would You Rather button â€“ appears in MAIN MENU after unlock -->
    <button id="wyrMenuBtn" class="big-btn" 
            style="display:none; background:linear-gradient(90deg, #ff99b4, #ff4081); 
                   margin-top:20px; font-size:1.6rem; box-shadow:0 6px 20px rgba(255,64,129,0.4);">
      Zagraj w Would You Ratherâ€¦ â™¡
    </button>
  </div>

  <!-- GRA -->
  <div id="game" class="screen">
    <div id="status">
      <div>Punkty: <span id="score">0</span></div>
      <div>CaÅ‚kowite: <span id="totalScoreGame">0</span></div>
      <div>Å»ycia: <span id="lives"></span></div>
    </div>

    <div id="question"></div>
    <div id="options"></div>
    <div id="result"></div>

    <button class="back-btn" id="backToMenuBtn">WrÃ³Ä‡ do menu</button>
  </div>

  <!-- NAGRODY -->
  <div id="rewardsScreen" class="screen">
    <h2>Twoje nagrody â¤ï¸</h2>
    <p class="total-points">Punkty: <span id="totalScoreRewards">0</span></p>
    <div id="rewardsList"></div>

    <!-- Drawing canvas â€“ will be shown here when the reward is unlocked -->
    <div id="drawReward" style="display:none; margin:30px 0; padding:25px;
  background:rgba(255,255,255,0.18); border-radius:20px;">

  <h3 style="color:#ff4081; margin-bottom:15px;">
    ğŸ¨ Narysuj naszÄ… przyszÅ‚oÅ›Ä‡ â™¡
  </h3>

  <p style="font-size:1.2rem; margin-bottom:15px;">
    MoÅ¼esz rysowaÄ‡ myszkÄ… lub palcem ğŸ’•  
    Zapisz rysunek, Å¼eby wrÃ³ciÄ‡ do niego pÃ³Åºniej.
    ZrÃ³b screenshota.
  </p>

  <!-- CANVAS -->
  <canvas id="drawCanvas" width="500" height="400"
    style="border:2px solid #ff4081;
           border-radius:14px;
           background:#fff;
           display:block;
           margin:0 auto;
           touch-action:none;
           max-width:100%;">
  </canvas>

  <!-- TOOLS -->
  <div style="margin-top:20px; text-align:center; display:flex;
              flex-wrap:wrap; gap:12px; justify-content:center;">

    <label>
      ğŸ¨ Kolor
      <input type="color" id="drawColor" value="#ff4081"
             style="width:44px; height:36px;">
    </label>

    <label>
      âœï¸ GruboÅ›Ä‡
      <input type="range" id="drawSize" min="1" max="20" value="4">
    </label>

    <button onclick="clearCanvas()"
      style="padding:10px 18px; background:#f44336; color:white;
             border:none; border-radius:8px; cursor:pointer;">
      WyczyÅ›Ä‡
    </button>

    <button onclick="saveDrawingFirebase()"
      style="padding:10px 18px; background:#4caf50; color:white;
             border:none; border-radius:8px; cursor:pointer;">
      ğŸ’¾ Zapisz rysunek nie dziala
    </button>

    <button onclick="openDrawingFullscreen()"
      style="padding:10px 18px; background:#ff4081; color:white;
             border:none; border-radius:8px; cursor:pointer;">
      ğŸ” PowiÄ™ksz
    </button>
    <!-- PODGLÄ„D OSTATNIEGO RYSUNKU -->
<div id="savedDrawingBox" style="margin-top:30px;">
  <h4 style="color:#ff4081; text-align:center;">
    ğŸ’¾ Ostatni zapisany rysunek
  </h4>

  <!-- obrazek zostanie wstawiony z JS -->
</div>

  </div>
</div>


    <button class="back-btn" id="backRewardsBtn">WrÃ³Ä‡ do menu</button>
  </div>

  <!-- KONIEC -->
  <div id="final" class="screen">
    <div id="finalContent"></div>
    <button class="big-btn play" id="finalMenuBtn">WrÃ³Ä‡ do menu</button>
  </div>

  <!-- DODAJ PYTANIE (NOWY EKRAN) -->
<div id="addQuestionScreen" class="screen">
  <h2>Dodaj pytanie do quizu ğŸ’•</h2>

  <!-- PYTANIE -->
  <div class="option">
    <input id="userQ" class="quiz-input" placeholder="TreÅ›Ä‡ pytania">
  </div>

  <!-- ODPOWIEDZI -->
  <div class="option"><input class="userA quiz-input" placeholder="OdpowiedÅº A"></div>
  <div class="option"><input class="userA quiz-input" placeholder="OdpowiedÅº B"></div>
  <div class="option"><input class="userA quiz-input" placeholder="OdpowiedÅº C"></div>
  <div class="option"><input class="userA quiz-input" placeholder="OdpowiedÅº D"></div>

  <!-- POPRAWNA -->
  <div class="option">
    <select id="userCorrect" class="quiz-input">
      <option value="0">Poprawna: A</option>
      <option value="1">Poprawna: B</option>
      <option value="2">Poprawna: C</option>
      <option value="3">Poprawna: D</option>
    </select>
  </div>

  <button class="big-btn play" onclick="saveUserQuestion()">ğŸ’¾ Zapisz pytanie</button>
  <button class="back-btn" onclick="showScreen('menu')">WrÃ³Ä‡ do menu</button>
</div>


</div>

<!-- Audio -->
<audio id="correctSound" src="correct.mp3" preload="auto"></audio>
<audio id="wrongSound" src="wrong.mp3" preload="auto"></audio>

<!-- Would You Rather Modal -->
<div id="wyrModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); 
                          z-index:3000; color:white; justify-content:center; align-items:center; padding:20px;">
  <div style="background:rgba(255,255,255,0.15); backdrop-filter:blur(10px); border-radius:24px; 
              padding:35px; max-width:700px; width:90%; text-align:center;">
    <h2 style="color:#ff4081; margin-bottom:25px;">Would you ratherâ€¦ z nami? â™¡</h2>
    <p id="wyrQuestion" style="font-size:1.5rem; margin:30px 0; line-height:1.6; white-space:pre-line;"></p>
    
    <div style="display:flex; flex-direction:column; gap:20px; margin:40px 0;">
      <button id="wyrA" class="big-btn" style="background:linear-gradient(90deg,#ff6f91,#ff4081);">Opcja A</button>
      <button id="wyrB" class="big-btn" style="background:linear-gradient(90deg,#ff6f91,#ff4081);">Opcja B</button>
    </div>
    
    <button onclick="closeWyrModal()" class="back-btn" style="margin-top:30px;">Zamknij</button>
  </div>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.88); 
                            color:white; z-index:2000; overflow-y:auto; padding:20px;">
  <div style="max-width:720px; margin:40px auto; background:rgba(255,255,255,0.12); 
              padding:30px; border-radius:16px; backdrop-filter:blur(8px);">
    <h2 style="color:#ff4081; text-align:center; margin-bottom:25px;">Panel administracyjny</h2>
    
    <p style="text-align:center; font-size:1.5rem; margin-bottom:30px;">
      Aktualne punkty: <strong id="adminTotal">0</strong>
    </p>

    <div style="text-align:center; margin:30px 0;">
      <input type="number" id="adminPointsInput" placeholder="np. 15 lub -5" 
             style="padding:12px 16px; font-size:1.4rem; width:160px; text-align:center; 
                    border-radius:8px; border:1px solid #ccc;">
      <button onclick="adminAddPoints()" style="padding:12px 28px; font-size:1.2rem; 
                                               background:#4caf50; color:white; border:none; 
                                               border-radius:8px; margin-left:15px; cursor:pointer;">
        Zastosuj
      </button>
    </div>

    <div style="text-align:center; margin:30px 0;">
      <button onclick="adminSetPoints(0)"   style="padding:10px 20px; background:#f44336; color:white; border:none; border-radius:8px; margin:6px; cursor:pointer;">Resetuj do 0</button>
      <button onclick="adminSetPoints(5)"   style="padding:10px 20px; background:#ff6f00; color:white; border:none; border-radius:8px; margin:6px; cursor:pointer;">â‰¥5 pkt</button>
      <button onclick="adminSetPoints(10)"  style="padding:10px 20px; background:#ff6f00; color:white; border:none; border-radius:8px; margin:6px; cursor:pointer;">â‰¥10 pkt</button>
      <button onclick="adminSetPoints(15)"  style="padding:10px 20px; background:#ff6f00; color:white; border:none; border-radius:8px; margin:6px; cursor:pointer;">â‰¥15 pkt</button>
      <button onclick="adminSetPoints(20)"  style="padding:10px 20px; background:#ff6f00; color:white; border:none; border-radius:8px; margin:6px; cursor:pointer;">â‰¥20 pkt</button>
      <button onclick="adminSetPoints(35)"  style="padding:10px 20px; background:#ff6f00; color:white; border:none; border-radius:8px; margin:6px; cursor:pointer;">â‰¥35 pkt</button>
    </div>

    <div style="text-align:center; margin-top:50px;">
      <button onclick="closeAdmin()" class="back-btn">Zamknij panel</button>
    </div>
  </div>
</div>



<!-- TWÃ“J SKRYPT -->
<script src="script.js"></script>

<!-- FIREBASE -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    onSnapshot,
    serverTimestamp,
    query,
    orderBy,
    limit
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
  import {
    getStorage,
    ref,
    uploadString,
    getDownloadURL
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBf7tYEGzG112MQ2xKmzKJv9SAZbH6Y7so",
    authDomain: "quiz-o-nas.firebaseapp.com",
    projectId: "quiz-o-nas",
    storageBucket: "quiz-o-nas.appspot.com",
    messagingSenderId: "467382949049",
    appId: "1:467382949049:web:bb92db1e925cebec257768"
  };

  // INIT
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // ğŸ”— udostÄ™pniamy funkcjÄ™ zapisu globalnie
  window.saveDrawingFirebase = async function () {
    const canvas = document.getElementById("drawCanvas");
    if (!canvas) return alert("Brak canvas");

    try {
      const dataURL = canvas.toDataURL("image/png");
      const fileName = `drawing_${Date.now()}.png`;

      const imgRef = ref(storage, `drawings/${fileName}`);
      await uploadString(imgRef, dataURL, "data_url");

      const url = await getDownloadURL(imgRef);

      await addDoc(collection(db, "drawings"), {
        url,
        createdAt: serverTimestamp()
      });

      alert("ğŸ’– Rysunek zapisany w Firebase!");
    } catch (e) {
      console.error(e);
      alert("âŒ BÅ‚Ä…d zapisu rysunku");
    }
  };

  // ğŸ‘€ PODGLÄ„D OSTATNIEGO RYSUNKU (NAGRODY)
  const q = query(
    collection(db, "drawings"),
    orderBy("createdAt", "desc"),
    limit(1)
  );

  onSnapshot(q, snap => {
    if (snap.empty) return;

    const data = snap.docs[0].data();
    const box = document.getElementById("savedDrawingBox");
    if (!box) return;

    let img = document.getElementById("savedDrawingPreview");
    if (!img) {
      img = document.createElement("img");
      img.id = "savedDrawingPreview";
      img.style = `
        max-width:100%;
        display:block;
        margin:20px auto;
        border-radius:16px;
        border:2px solid #ff4081;
      `;
      box.appendChild(img);
    }

    img.src = data.url;
  });
</script>


</body>
</html>

