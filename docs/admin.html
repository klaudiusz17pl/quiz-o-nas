<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin – Quiz o nas ❤️</title>

  <style>
    body { background:#111; color:#fff; font-family:Segoe UI,sans-serif; padding:30px; }
    .container { max-width:800px; margin:0 auto; background:rgba(255,255,255,0.08); padding:40px; border-radius:16px; }
    h1 { color:#ff4081; text-align:center; margin-bottom:30px; }
    h3 { color:#ff6f91; margin:40px 0 15px; }
    .choice { background:rgba(255,255,255,0.05); padding:16px; margin:12px 0; border-radius:12px; border-left:5px solid #ff4081; }
    .choice strong { color:#ffb3c6; }
    button { padding:10px 18px; margin-top:10px; border:none; border-radius:8px; cursor:pointer; }
  </style>
</head>

<body>
<div class="container">

<h1>Panel administracyjny ❤️</h1>

<p style="text-align:center;font-size:1.4rem;">
  Aktualne punkty: <strong id="adminTotal">0</strong>
</p>

<div style="text-align:center;margin:30px 0;">
  <input type="number" id="pointsInput" placeholder="Dodaj / odejmij"
    style="padding:10px;font-size:1.2rem;width:160px;text-align:center;">
  <button onclick="changePoints()" style="background:#4caf50;color:white;">Zastosuj</button>
</div>

<div style="text-align:center;">
  <button onclick="setPoints(0)" style="background:#f44336;color:white;">Reset</button>
  <button onclick="setPoints(10)">10</button>
  <button onclick="setPoints(20)">20</button>
  <button onclick="setPoints(35)">35</button>
</div>

<h3>Wszystkie pytania quizu</h3>
<div id="quizQuestionsList"></div>

</div>

<!-- ================= FIREBASE ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, onSnapshot, deleteDoc, doc }
  from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBf7tYEGzG112MQ2xKmzKJv9SAZbH6Y7so",
  authDomain: "quiz-o-nas.firebaseapp.com",
  projectId: "quiz-o-nas",
  storageBucket: "quiz-o-nas.appspot.com",
  messagingSenderId: "467382949049",
  appId: "1:467382949049:web:bb92db1e925cebec257768"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ===== HASŁO ===== */
const ADMIN_PASSWORD = "Klaudiusz+Marysia";
const entered = prompt("Podaj hasło administracyjne:");
if (entered !== ADMIN_PASSWORD) {
  alert("Błędne hasło");
  window.close();
}

/* ===== PYTANIA WBUdOWANE ===== */
const BUILT_IN = [
  { q:"Kiedy się poznaliśmy?", answers:["14 lutego","1 marca","28 stycznia","18 sierpnia"], correct:2 },
  { q:"Jakim pieszczotliwym imieniem mnie nazywałaś?", answers:["Wszystkie","Kochanie","Misiu","Baranek"], correct:0 }
];

/* ===== RENDER ===== */
const container = document.getElementById("quizQuestionsList");

function renderQuestion(q, type, id=null) {
  const color = type === "built" ? "#ff4081" : "#4caf50";
  const label = type === "built" ? "Wbudowane" : "Dodane przez nią";

  return `
    <div class="choice" style="border-left-color:${color}">
      <div onclick="toggleAnswers(this)">
        <strong>${q.q}</strong>
        <div style="font-size:.85rem;color:${color}">
          ${label} • kliknij aby zobaczyć
        </div>
      </div>
      <div class="answers" style="display:none;margin-top:10px">
        ${q.answers.map((a,i)=>`
          <div>${i===q.correct?`<b>${a}</b>`:a}</div>`).join("")}
        ${id?`
          <button onclick="deleteQ('${id}')" style="background:#f44336;color:white">
            Usuń
          </button>`:""}
      </div>
    </div>
  `;
}

window.toggleAnswers = el => {
  const a = el.nextElementSibling;
  a.style.display = a.style.display==="none"?"block":"none";
};

window.deleteQ = async id => {
  if (!confirm("Usunąć pytanie?")) return;
  await deleteDoc(doc(db,"questions",id));
};

/* ===== FIRESTORE LIVE ===== */
onSnapshot(collection(db,"questions"), snap=>{
  container.innerHTML="";
  BUILT_IN.forEach(q=>{
    container.innerHTML += renderQuestion(q,"built");
  });
  snap.forEach(d=>{
    container.innerHTML += renderQuestion(d.data(),"custom",d.id);
  });
});

/* ===== PUNKTY ===== */
let total = Number(localStorage.getItem("quizTotalPoints")||0);
document.getElementById("adminTotal").textContent = total;

window.changePoints = ()=>{
  const v = Number(pointsInput.value);
  if(isNaN(v)) return;
  total+=v;
  save();
};

window.setPoints = v=>{
  total=v;
  save();
};

function save(){
  localStorage.setItem("quizTotalPoints",total);
  adminTotal.textContent=total;
}
</script>

</body>
</html>
